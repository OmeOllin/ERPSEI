@page
@using Microsoft.AspNetCore.Mvc.Localization
@using ERPSEI.Data.Entities.Empleados;
@using ERPSEI.Data.Managers;
@inject IViewLocalizer Localizer
@inject IRCatalogoManager<Genero> GenerosManager;
@inject IRCatalogoManager<EstadoCivil> EstadosCivilesManager;
@model IndexModel
@{
    ViewData["Title"] = Localizer["Title"];
    ViewData["ActivePage"] = ManageNavPages.Index;

    List<Genero> generos = await GenerosManager.GetAllAsync();
    List<EstadoCivil> estadosCiviles = await EstadosCivilesManager.GetAllAsync();
}

<form id="profile-form" method="post" enctype="multipart/form-data">
    <h3>@ViewData["Title"]</h3>
    <br />
    <hr />
    <h5>@Localizer["FirstSectionTitle"]</h5>
    <br />
    <partial name="_StatusMessage" for="StatusMessage" />
    <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>
    <div class="row">
        <div class="col-lg-6">
            <center>
                <div>
                    <img id="profilePicContainer" class="profile-pic mb-3" src="@Model.ProfilePictureSrc" />
                </div>
                <div style="width:auto;" class="mb-3">
                    <input asp-for="Input.ProfilePicture" type="file" id="profilePicSelector" onchange="onProfilePicSelectorChanged(this);" accept="image/png, image/jpeg" hidden />
                    <a id="editProfilePicLink" class="btn btn-primary" onclick="onEditDocumentClick(this);" inputName="profilePicSelector">
                        <i class="bi bi-pencil-fill"></i> @Localizer["EditLink"]
                    </a>
                </div>
            </center>
            <div class="alert alert-primary d-flex align-items-center" role="alert">
                <i class="bi bi-info-circle-fill me-2" style="font-size: x-large"></i>
                <div>
                    @Localizer["ProfilePicSuggestion"]
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoPrimerNombre" asp-for="Input.FirstName" type="text" class="form-control formInput" placeholder="@Localizer["NombrePlaceholder"]" />
                        <label for="inpEmpleadoPrimerNombre" asp-for="Input.FirstName" class="form-label"></label>
                        <span asp-validation-for="Input.FirstName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoNombrePreferido" asp-for="Input.NombrePreferido" type="text" class="form-control formInput" placeholder="@Localizer["NombrePreferidoPlaceholder"]" />
                        <label for="inpEmpleadoNombrePreferido" asp-for="Input.NombrePreferido" class="form-label"></label>
                        <span asp-validation-for="Input.NombrePreferido" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoApellidoPaterno" asp-for="Input.FathersLastName" type="text" class="form-control formInput" placeholder="@Localizer["ApellidoPaternoPlaceholder"]" />
                        <label for="inpEmpleadoApellidoPaterno" asp-for="Input.FathersLastName" class="form-label"></label>
                        <span asp-validation-for="Input.FathersLastName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoApellidoMaterno" asp-for="Input.MothersLastName" type="text" class="form-control formInput" placeholder="@Localizer["ApellidoMaternoPlaceholder"]" />
                        <label for="inpEmpleadoApellidoMaterno" asp-for="Input.MothersLastName" class="form-label"></label>
                        <span asp-validation-for="Input.MothersLastName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoFechaNacimiento" type="date" asp-for="Input.FechaNacimiento" class="form-control formInput" placeholder="@Localizer["FechaNacimientoPlaceholder"]" />
                        <label for="inpEmpleadoFechaNacimiento" asp-for="Input.FechaNacimiento" class="form-label"></label>
                        <span asp-validation-for="Input.FechaNacimiento" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoTelefono" asp-for="Input.PhoneNumber" type="text" class="form-control formInput" placeholder="@Localizer["TelefonoPlaceholder"]" />
                        <label for="inpEmpleadoTelefono" asp-for="Input.PhoneNumber" class="form-label"></label>
                        <span asp-validation-for="Input.PhoneNumber" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <select id="selEmpleadoGeneroId" asp-for="Input.GeneroId" class="form-select formSelect" placeholder="@Localizer["GeneroPlaceholder"]">

                            @{
                                foreach (Genero genero in generos)
                                {
                                    <option value='@genero.Id'>@genero.Nombre</option>
                                }
                            }
                        </select>
                        <label for="selEmpleadoGeneroId" asp-for="Input.GeneroId" class="form-label"></label>
                        <span asp-validation-for="Input.GeneroId" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-6">
                    <div class="form-floating mb-3">
                        <select id="selEmpleadoEstadoCivilId" asp-for="Input.EstadoCivilId" class="form-select formSelect" placeholder="@Localizer["EstadoCivilPlaceholder"]">

                            @{
                                foreach (EstadoCivil estadoCivil in estadosCiviles)
                                {
                                    <option value='@estadoCivil.Id'>@estadoCivil.Nombre</option>
                                }
                            }
                        </select>
                        <label for="selEmpleadoEstadoCivilId" asp-for="Input.EstadoCivilId" class="form-label"></label>
                        <span asp-validation-for="Input.EstadoCivilId" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-12">
                    <div class="form-floating mb-3">
                        <textarea id="txtEmpleadoDireccion" maxlength="135" asp-for="Input.Direccion" class="form-control dynamic-height formInput" placeholder="@Localizer["DireccionPlaceholder"]"></textarea>
                        <label for="txtEmpleadoDireccion" asp-for="Input.Direccion" class="form-label"></label>
                        <span asp-validation-for="Input.Direccion" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-4">
            <div class="form-floating mb-3">
                <input id="inpEmpleadoCURP" asp-for="Input.CURP" type="text" class="form-control formInput" placeholder="@Localizer["CURPPlaceholder"]" />
                <label for="inpEmpleadoCURP" asp-for="Input.CURP" class="form-label"></label>
                <span asp-validation-for="Input.CURP" class="text-danger"></span>
            </div>
        </div>
        <div class="col-4">
            <div class="form-floating mb-3">
                <input id="inpEmpleadoRFC" asp-for="Input.RFC" type="text" class="form-control formInput" placeholder="@Localizer["RFCPlaceholder"]" />
                <label for="inpEmpleadoRFC" asp-for="Input.RFC" class="form-label"></label>
                <span asp-validation-for="Input.RFC" class="text-danger"></span>
            </div>
        </div>
        <div class="col-4">
            <div class="form-floating mb-3">
                <input id="inpEmpleadoNSS" asp-for="Input.NSS" type="text" class="form-control formInput" placeholder="@Localizer["NSSPlaceholder"]" />
                <label for="inpEmpleadoNSS" asp-for="Input.NSS" class="form-label"></label>
                <span asp-validation-for="Input.NSS" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-6">
            <div class="row">
                <h6 class="col-12"><i>@Localizer["EmpleadoContactoTitle"] 1</i></h6>
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoNombreContacto1" asp-for="Input.NombreContacto1" type="text" class="form-control formInput" placeholder="@Localizer["NombrePlaceholder"]" />
                        <label for="inpEmpleadoNombreContacto1" asp-for="Input.NombreContacto1" class="form-label"></label>
                        <span asp-validation-for="Input.NombreContacto1" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoTelefonoContacto1" asp-for="Input.TelefonoContacto1" type="text" class="form-control formInput" placeholder="@Localizer["TelefonoPlaceholder"]" />
                        <label for="inpEmpleadoTelefonoContacto1" asp-for="Input.TelefonoContacto1" class="form-label"></label>
                        <span asp-validation-for="Input.TelefonoContacto1" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-6">
            <div class="row">
                <h6 class="col-12"><i>@Localizer["EmpleadoContactoTitle"] 2</i></h6>
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoNombreContacto2" asp-for="Input.NombreContacto2" type="text" class="form-control formInput" placeholder="@Localizer["NombrePlaceholder"]" />
                        <label for="inpEmpleadoNombreContacto2" asp-for="Input.NombreContacto2" class="form-label"></label>
                        <span asp-validation-for="Input.NombreContacto2" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                    <div class="form-floating mb-3">
                        <input id="inpEmpleadoTelefonoContacto2" asp-for="Input.TelefonoContacto2" type="text" class="form-control formInput" placeholder="@Localizer["TelefonoPlaceholder"]" />
                        <label for="inpEmpleadoTelefonoContacto2" asp-for="Input.TelefonoContacto2" class="form-label"></label>
                        <span asp-validation-for="Input.TelefonoContacto2" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr />
    <h5>@Localizer["SecondSectionTitle"]</h5>
    <br />
    <div class="alert alert-primary d-flex align-items-center" role="alert">
        <i class="bi bi-info-circle-fill me-2" style="font-size: x-large"></i>
        <div>
            @Localizer["DocumentSuggestion"]
        </div>
    </div>
    <br />
    <div class="row">
        @{
            foreach (IndexModel.FileFromGet fd in Model.FilesFromGet)
            {
                string[] srcElements = fd.Src.Split(',', StringSplitOptions.RemoveEmptyEntries);
                string b64 = srcElements.Length >= 2 ? srcElements[1] : "";
                if (b64.Length >= 1) { b64 = b64.Substring(0, b64.Length - 30); }
                string? enumName = System.Enum.GetName(typeof(FileTypes), fd.TypeId) ?? "";
                string containerId = Guid.NewGuid().ToString();
                string selectorId = Guid.NewGuid().ToString();

                string containerClass = "document-container-empty";
                string iconClass = "opacity-25";
                string nameClass = "opacity-25";
                string fileName = Localizer["EmptySelectItemText"].Value;

                if (b64.Length >= 1) {
                    //Si trae base64, agrega un archivo al DOM con la información.
                    containerClass = "document-container-filled";
                    iconClass = "document-icon-filled";
                    nameClass = "document-name-filled";
                    fileName = fd.Name;
                }

                <div class="col-12 col-xl-6">
                    <div><b>@Localizer[enumName]</b></div>
                    <div id="container{@fd.TypeId}" class="alert mb-2 mt-2 @containerClass row me-0">
                        <div id="fileIcon{@fd.TypeId}" class="align-self-center col-1 @iconClass"><i class='bi bi-file-image' style='font-size:25px'></i></div>
                        <div id="fileName{@fd.TypeId}" class="align-self-center col-10 @nameClass p-2" style="display:flex; color:dimgray"><div class='overflowed-text'>@fileName</div></div>
                        <div class="align-self-center col-1">
                            <input type="hidden" name="FilesFromGet.Index" value="@fd.FileId" />
                            <input type="hidden" name="FilesFromGet[@fd.FileId].FileId" value="@fd.FileId" />
                            <input type="hidden" name="FilesFromGet[@fd.FileId].TypeId" value="@fd.TypeId" />
                            <input name="FilesFromGet[@fd.FileId].File" type="file" id="selector{@fd.TypeId}" b64="@b64" sourceName="@fd.FileId" sourceLength="@b64.Length" tipoArchivoId="@fd.TypeId" containerName="container{@fd.TypeId}" fileIconName="fileIcon{@fd.TypeId}" fileNameName="fileName{@fd.TypeId}" onchange="onDocumentSelectorChanged(this);" accept="image/png, image/jpeg, application/pdf" hidden />
                            <a class='btn btn-sm btn-primary mb-1' onclick='onEditDocumentClick(this);' inputName="selector{@fd.TypeId}"><i class='bi bi-pencil-fill'></i></a>
                            <a class="btn btn-sm btn-primary disableable mb-1" inputName="selector{@fd.TypeId}" onclick="onDeleteClick(this);" sourceId="selector{@fd.TypeId}" sourceLength="@b64.Length"><i class="bi bi-x-lg"></i></a>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
    <hr />
    <div class="col-12 text-end">
        <button id="update-profile-button" type="submit" class="btn btn-lg btn-primary">
            <i class="bi bi-floppy2-fill"></i>
            @Localizer["SaveButton"]
        </button>
    </div>
    @* <table class="table table-bordered" align="center" style="width:auto;">
        <thead>
            <tr align="center">
                <th scope="col"></th>
                <th scope="col">Nombre documento</th>
                <th scope="col">Documento</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            @{
                foreach (IndexModel.FileFromGet fd in Model.FilesFromGet)
                {
                    //Obtiene el nombre del tipo.
                    string? enumName = System.Enum.GetName(typeof(FileTypes),fd.TypeId) ?? "";
                    string containerId = Guid.NewGuid().ToString();
                    string selectorId = Guid.NewGuid().ToString();

                    <tr valign="middle" align="center">
                        <th scope="row">@fd.TypeId</th>
                        <td><b>@Localizer[@enumName]</b></td>
                        <td>
                            <div id="@containerId" class="document-container">
                                @Html.Raw(fd.Src)
                            </div>
                        </td>
                        <td align="left">
                            <div style="width:auto;">
                                <input type="hidden" name="FilesFromGet.Index" value="@fd.FileId" />
                                <input type="hidden" name="FilesFromGet[@fd.FileId].FileId" value="@fd.FileId" />
                                <input type="hidden" name="FilesFromGet[@fd.FileId].TypeId" value="@fd.TypeId" />
                                <input name="FilesFromGet[@fd.FileId].File" type="file" id="@selectorId" containerName="@containerId" onchange="onDocumentSelectorChanged(this);" accept="image/png, image/jpeg, application/pdf" hidden />
                                <a class="btn mb-1" onclick="onEditDocumentClick(this);" inputName="@selectorId">
                                    <i class="bi bi-pencil-fill"></i>
                                </a>
                                <a class="btn disableable mb-1" asp-page="/FileViewer" asp-route-id="@fd.FileId" target="_blank" sourceLength="@fd.Src.Length">
                                    <i class="bi bi-search"></i>
                                </a>
                                <a class="btn disableable mb-1" onclick="onDeleteClick(this);" sourceId="@selectorId" sourceLength="@fd.Src.Length">
                                    <i class="bi bi-x-lg"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table> *@
</form>

@section Scripts {
    <script type="text/javascript">
        var fileFormatTitle = '@Localizer["FileFormatTitle"]';
        var fileFormatMessage = '@Localizer["FileFormatMessage"]';
        var maxFileSizeTitle = '@Localizer["MaxFileSizeTitle"]';
        var maxFileSizeMessage = '@Localizer["MaxFileSizeMessage"]';
    </script>

    <partial name="_ValidationScriptsPartial" />
    <script src="~/lib/pdfjs/pdf.js"></script>
    <script src="~/../Areas/Identity/Pages/Account/Manage/Index.cshtml.js"></script>
}
